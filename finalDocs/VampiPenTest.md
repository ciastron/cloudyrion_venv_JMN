# VAMPI PENTEST REPORT

This document provides a report of the vulnerabiilties that we have found on VampI APIs.

## Brute Force Password Discovery of the JWT
Marco here

## Forge JWT with Longer Expiration Date


## Update of Password of Admin User
### Description
This vulnerability is related to a bug in the code. In particular, an authenticated user can modify the password of any user in the database (including the admin).

The API responsible for this behavior is `PUT /users/v1/{username}/password`.

### Steps
We log in with our user (Bob) and we retrieve the authentication JWT token.
We modify the admin password with the following HTTP request
```
PUT /users/v1/admin/password
...
Authorization: {JWT TOKEN}
Content-type: application/json
{   
   "password" : "qwerty"
}
```
### PoC
1. We update the password of the admin.

   ![PoCAdmin](img/PoCadminPWD.png)

2. We login with the new admin's password.
   ![PoCAdmin](img/PoCadminPWD2.png)

### Mitigation
Review the source code and allow the users to modify their password checking the username stored in the JWT (not the one in the URL).

## User Enumeration
### Description
The username enumeration is an activity in which an attacker tries to retrieve valid usernames from a web application. The web applications are mostly vulnerable to this type of attack on login pages, registration form pages or password reset pages.

The are several APIs vulnerable to user enumerations in VampI.
- POST /users/v1/register
   - This POST request requires a JSON object as input: {"username": "test1",  "password": "tes1", "email": "test1"}.
   - If the application receives a JSON object with the structure {"username" : "test1"}, it first checks if "test1" is present in the DB, if yes, the application replies back with 200 OK saying that the username is already present in the DB, otherwise (test1 is not present in the DB) the application replies with an error code because the structure of the input is wrong.

### PoC
When sending a POST request, the payload is crafted using BurpSuite and we sent only the username of an existing account.
![user enum 1](img/uenum1.png)

### Mitigation
1. Login Page
  - Make sure to return a generic “No such username or password” message when a login failure occurs.
  - Make sure the HTTP response, and the time taken to respond are no different when a username does not exist, and an incorrect password is entered.
2. Registration Page
  - Avoid having your site tell people that a supplied username is already taken.
  - If your usernames are email addresses, send a password reset email if a user tries to sign-up with an existing address.
  - If usernames are not email addresses, protect your sign-up page with a CAPTCHA.

### Side notes: 
The email field is not checked in the backed, for instance, a wrong email address does not trigger any error in the application.

## SQL Injection

### Description

A SQL injection attack consists of insertion or "injection" of a SQL query via the input data from the client to the application. A successful SQL injection exploit can read sensitive data from the database, modify database data (Insert/Update/Delete), execute administration operations on the database, recover the content of a given file present on the DBMS file system and in some cases issue commands to the operating system. SQL injection attacks are a type of injection attack, in which SQL commands injected into data-plane input in order to effect the execution of predefined SQL commands. The login page is vulnerable to SQL injection attacks using that an attacker can login to the application without knowing the credentials. 


### Steps


### PoC
![SQL-Injection](img/sql(1).png)


### Mitigation

To prevent SQL Injection attacks is input validation and parametrized queries including prepared statements. The application code should never use the input directly. The developer must sanitize all input, not only web form inputs such as login forms. They must remove potential malicious code elements such as single quotes. It is also a good idea to turn off the visibility of database errors on your production sites. Database errors used with SQL Injection to gain information about your database. 

## Bola Broken Object Level Authorization

### Description

Broken object level authorization is a security vulnerability that occurs when an application does not correctly confirm that the user making the request has the required privileges.

### Steps

We login with a user, in this case "name2". We want to view the books (bookTitle2) that user "name1" should only be able to see.
```
GET /books/v1/bookTitle2 HTTP/1.1
...
Authorization: {JWT "name2" Token}
Content-Type: application/json
```

### PoC

User "name2" Authentication Token:

![bola01](img/bola01.png)

We were able to see the book as user "name2":

![bola02](img/bola02.png)

### Mitigation

- Implement a proper authorization mechanism that relies on the user policies and hierarchy.
- Use an authorization mechanism to check if the logged-in user has access to perform the requested action on the record in every function that uses an           input from the client to access a record in the database.
- Prefer to use random and unpredictable values as GUIDs for records’ IDs.
- Write tests to evaluate the authorization mechanism. Do not deploy vulnerable changes that break the tests.


## Mass Assignment

Jonas here!

